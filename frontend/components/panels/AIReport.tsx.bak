'use client'

import { motion } from 'framer-motion'
import { FileText, AlertCircle, Target, Shield, Sparkles, TrendingDown } from 'lucide-react'

interface AIReportProps {
  report: {
    overall_outlook: string
    key_risks: string[]
    strategic_recommendation: string
    risk_mitigation: string[]
  }
  generatedAt: string
  loading?: boolean
}

export function AIReport({ report, generatedAt, loading }: AIReportProps) {
  if (loading) {
    return (
      <motion.div
        initial={{ opacity: 0, y: 20 }}
        animate={{ opacity: 1, y: 0 }}
        transition={{ duration: 0.4, delay: 0.5 }}
        className="swiss-card overflow-hidden animate-pulse"
      >
        <div className="-mx-8 -mt-8 mb-8 px-8 py-5 bg-slate-900 flex items-center gap-3">
          <Sparkles className="w-5 h-5 text-slate-300 animate-spin" />
          <h3 className="text-base font-black uppercase tracking-tight text-white">AI Planning Report</h3>
        </div>
        <div className="space-y-4">
          <div className="h-4 bg-swiss-muted w-full" />
          <div className="h-4 bg-swiss-muted w-5/6" />
          <div className="h-4 bg-swiss-muted w-4/6" />
          <div className="h-8 bg-swiss-muted w-full mt-8" />
          <div className="h-4 bg-swiss-muted w-3/4" />
        </div>
        <p className="text-xs uppercase tracking-wider opacity-40 text-center mt-8">
          Generating AI insights...
        </p>
      </motion.div>
    )
  }

  // Derive verdict from outlook text
  const outlookLower = report.overall_outlook.toLowerCase()
  const verdict = outlookLower.includes('strong') ? 'STRONG PROSPECT'
    : outlookLower.includes('moderate') ? 'MODERATE PROSPECT'
    : 'PROCEED WITH CAUTION'
  const verdictClass = outlookLower.includes('strong') ? 'verdict-strong'
    : outlookLower.includes('moderate') ? 'verdict-moderate'
    : 'verdict-caution'

  return (
    <motion.div
      initial={{ opacity: 0, y: 20 }}
      animate={{ opacity: 1, y: 0 }}
      transition={{ duration: 0.4, delay: 0.5 }}
      className="swiss-card overflow-hidden"
    >
      {/* Header strip — dark slate, bleeds to card edges */}
      <div className="-mx-8 -mt-8 mb-8 px-8 py-5 bg-slate-900 flex items-center justify-between">
        <div className="flex items-center gap-3">
          <Sparkles className="w-5 h-5 text-slate-300" />
          <h3 className="text-base font-black uppercase tracking-tight text-white">AI Planning Report</h3>
        </div>
        <span className={verdictClass}>{verdict}</span>
      </div>

      <div className="space-y-8">
        {/* 01 Overall Outlook */}
        <div>
          <div className="flex items-center gap-3 mb-3">
            <span className="text-slate-700 text-xs font-black tracking-widest">01</span>
            <div className="flex items-center gap-2">
              <FileText className="w-4 h-4 text-slate-600" />
              <h4 className="text-xs font-black uppercase tracking-wider text-slate-800">Overall Outlook</h4>
            </div>
          </div>
          <p className="text-sm leading-relaxed pl-8 border-l-2 border-swiss-black/10 text-slate-900 font-semibold">
            {report.overall_outlook}
          </p>
        </div>

        {/* 02 Key Risks */}
        <div>
          <div className="flex items-center gap-3 mb-3">
            <span className="text-slate-700 text-xs font-black tracking-widest">02</span>
            <div className="flex items-center gap-2">
              <AlertCircle className="w-4 h-4 text-red-600" />
              <h4 className="text-xs font-black uppercase tracking-wider text-slate-800">Key Risks</h4>
            </div>
          </div>
          <ul className="space-y-3 pl-8">
            {report.key_risks.map((risk, index) => (
              <motion.li
                key={index}
                initial={{ opacity: 0, x: -10 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.6 + index * 0.1 }}
                className="flex items-start gap-3"
              >
                <span className="text-red-600 font-black mt-0.5 flex-shrink-0">→</span>
                <span className="text-sm leading-relaxed text-slate-900 font-semibold">{risk}</span>
              </motion.li>
            ))}
          </ul>
        </div>

        {/* 03 Strategic Recommendation */}
        <div className="border-l-4 border-slate-900 pl-6 py-2 bg-slate-50">
          <div className="flex items-center gap-3 mb-3">
            <span className="text-slate-700 text-xs font-black tracking-widest">03</span>
            <div className="flex items-center gap-2">
              <Target className="w-4 h-4 text-slate-600" />
              <h4 className="text-xs font-black uppercase tracking-wider text-slate-800">Strategic Recommendation</h4>
            </div>
          </div>
          <p className="text-sm leading-relaxed text-slate-900 font-semibold">
            {report.strategic_recommendation}
          </p>
        </div>

        {/* 04 Risk Mitigation */}
        <div>
          <div className="flex items-center gap-3 mb-3">
            <span className="text-slate-700 text-xs font-black tracking-widest">04</span>
            <div className="flex items-center gap-2">
              <Shield className="w-4 h-4 text-slate-600" />
              <h4 className="text-xs font-black uppercase tracking-wider text-slate-800">Risk Mitigation</h4>
            </div>
          </div>
          <ul className="space-y-3 pl-8">
            {report.risk_mitigation.map((item, index) => (
              <motion.li
                key={index}
                initial={{ opacity: 0, x: -10 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.8 + index * 0.1 }}
                className="flex items-start gap-3"
              >
                <span className="text-slate-700 font-black mt-0.5 flex-shrink-0">✓</span>
                <span className="text-sm leading-relaxed text-slate-900 font-semibold">{item}</span>
              </motion.li>
            ))}
          </ul>
        </div>
      </div>

      {/* Footer */}
      <div className="mt-8 pt-6 border-t-2 border-swiss-black/10 flex items-center justify-between">
        <span className="text-xs uppercase tracking-wider opacity-30">AI-Generated Analysis</span>
        <span className="text-xs uppercase tracking-wider opacity-30">
          {generatedAt ? new Date(generatedAt).toLocaleString('en-GB') : ''}
        </span>
      </div>
    </motion.div>
  )
}
